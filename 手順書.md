# 1. 手順書

初期設定とは異なり、複数回実行する可能性のある手順を記載しています。

- [1. 手順書](#1-手順書)
  - [1.1. Python仮想環境](#11-python仮想環境)
    - [1.1.1. 前提](#111-前提)
    - [1.1.2. 前準備](#112-前準備)
    - [1.1.3. 仮想環境の構築](#113-仮想環境の構築)
    - [1.1.4. 仮想環境の有効化](#114-仮想環境の有効化)
  - [1.2. よく使うコマンド](#12-よく使うコマンド)
    - [1.2.1. Homebrew](#121-homebrew)
    - [1.2.2. pyenv](#122-pyenv)
    - [1.2.3. venv](#123-venv)
    - [1.2.5. yt-dlp](#125-yt-dlp)
    - [1.2.6. git](#126-git)
    - [1.2.7. その他のコマンド](#127-その他のコマンド)

## 1.1. Python仮想環境

### 1.1.1. 前提

Homebrewでpyenvを管理し、pyenvでPythonのバージョンを管理します。venvで仮想環境を作成します。  
「~/Documents/Code/NewProject」というフォルダが作業フォルダである、という想定です。  
また、仮想環境名はこれまで個別に考えていましたが、面倒なので「.venv」に統一します。隠しフォルダとして扱われるので、役割的にも都合がいいです。

### 1.1.2. 前準備

仮想環境の構築、およびその有効化にはコマンドを使用しますが、長くて使いづらいのでエイリアスを設定します。「~/.zshrc」を編集します。

```".zshrc"
alias venva="source ./.venv/bin/activate"
alias venvc="python -m venv .venv"
```

### 1.1.3. 仮想環境の構築

まず、プロジェクトで使うフォルダに移動します。通常、フォルダの移動には`cd`コマンドを使用します。しかし、初期設定で`AUTO_CD`を設定したため、`cd`コマンドを省略することができ、パス名を直接入力するだけで済みます。

```shell
Documents/Code/NewProject
```

もし、グローバルに設定したバージョンと異なるバージョンで開発を行いたい場合、そのバージョンのPythonをインストールし、ローカルに設定します。そうすることで、このフォルダ内に限り、そのバージョンのPythonが実行されます。  
例えば、グローバルに設定されている`3.11.3`ではなく、`3.8.0`を使用したい場合には、以下のコマンドを実行します。

```shell
pyenv install 3.8.0
pyenv local 3.8.0
```

最後に、仮想環境の構築を行います。初期設定のおかげで、以下のコマンドだけでvenvモジュールが実行され、「.venv」フォルダが作成されます。このフォルダ内に、仮想環境の設定ファイルやインストールしたモジュールが配置されます。

```shell
venvc
```

### 1.1.4. 仮想環境の有効化

初期設定のおかげで、以下のコマンドだけで仮想環境の有効化が完了します。

[!WARNING]
実行前に、プロジェクトフォルダに移動していることを確認してください。

```shell
venva
```

## 1.2. よく使うコマンド

### 1.2.1. Homebrew

```shell
brew install [formulae]
brew uninstall [formulae]
brew search [formulae]
brew info [formulae]
brew list
brew update # Homebrew自体のアップデート
brew upgrade # Homebrewとフォーミュラのアップデート
brew tap 
brew tap [repository]
brew untap [repository]
```

### 1.2.2. pyenv

```shell
# yenvでインストール可能なバージョン一覧を表示する
pyenv install --list

pyenv install [version]
pyenv uninstall [version]

pyenv global [version]
pyenv local [version]
```

### 1.2.3. venv

```shell
# 仮想環境を構築するエイリアス。「.venv」を作成する。
venvc

# 仮想環境を起動するエイリアス。
venva

# 仮想環境を終了するコマンド
deactivate
```

### 1.2.5. yt-dlp

```shell
yt-dlp --cookies-from-browser safari URL

# 最高画質＋最高音質で動画をダウンロードするエイリアス。
video URL

# 最高音質で音声をダウンロードするエイリアス。
audio URL
```

### 1.2.6. git

```shell
# カレントディレクトリからリポジトリを作成する。
git init

# コミットする前に、どのファイルをコミットするかを選んでステージに上げる。
git add

# 現在のローカルリポジトリの状態を、Github等のリモートリポジトリに反映させる。
git push

git clone [URL]
```

### 1.2.7. その他のコマンド

```shell
mkdir [folder]
touch [file]

# macOSをアップデートした時に必要になる場合がある。
xcode-select --install

# webmをmp4に変換する場合。ただし、CPUを酷使する。
ffmpeg -i video.webm video.mp4

# InvokeAIのWebUIを起動する。
cd InvokeAI
venva
invokeai --web

# BからAへのシンボリックリンクを作成する。プログラム等でBを参照すると、実質的にはAを参照する。
ln -s Path/to/A Path/to/B
```
